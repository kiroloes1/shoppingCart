<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Meta SEO -->
  <meta name="description" content="E-commerce website for medicines and products" />
  <meta name="keywords" content="pharmacy, medicines, ecommerce, health" />
  <meta name="author" content="Kiroloes Reda" />
  <link rel="icon" href="./img/f1.ico">
  <title>products page</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.tailwindcss.com"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="./style.css" />

  <style>

  </style>
</head>

<body class="bg-slate-50">

<header class="py-8 bg-[var(--light)] border-b-2 border-[var(--dark)] rounded-b-sm sticky top-0 z-50 shadow-md ">
  <div class="flex justify-around items-center">

    <!-- Logo -->
    <a href="./index.html" class="text-[var(--dark)] font-bold text-xl">
      fashonShoping
    </a>

    <!-- Navigation for meduim device or more -->
    <nav class="flex items-center">
      <ul class="hidden md:flex [&>li]:text-[var(--black)] [&>li]:font-semibold [&>li]:px-2 lg:[&>li]:px-3 xl:[&>li]:px-4">
        <li ><a href="./index.html">Home</a></li>
        <li><a href="./about.html">About</a></li>
        <li><a href="./trackOrder.html">Track Order</a></li>
        <li><a href="./wishlist.html">Wishlist</a></li>
        <li><a href="./blog.html">Blog</a></li>
        <li><a href="./contact.html">Contact</a></li>
        <li><a href="./products.html"><i class="cursor-pointer fa-solid fa-magnifying-glass"></i></a></li>
       
        <li class=""><i class=" fa-solid fa-user cursor-pointer text-[var(--dark)]"></i></li>           
        <li class="relative list-none">
               <a class="text-[var(--orange)]" href="./cart.html"><i class="fa-solid fa-cart-shopping cursor-pointer text-[var(--dark)] text-xl"></i></a>
            <span id="cart-count" class="absolute -top-2 -right-1 xl:right-2 bg-red-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full shadow">0</span></li>

      </ul>
    </nav>

    <!-- manual menu -->
 <div id="menu-btn" class="menuBar md:hidden">
    <div class="bar1"></div>
    <div class="bar2"></div>
    <div class="bar3"></div>
 </div>

  </div>
</header>



<!-- nav bar for small device -->
<div id="mobile-menu" class="hidden md:hidden p-5 shadow-md z-30 fixed w-full top-20 bg-white">
        <ul class="  flex flex-col gap-3 [&>li]:text-[var(--black)] [&>li]:font-semibold [&>li]:px-2 lg:[&>li]:px-3 xl:[&>li]:px-4">
        <li ><a href="./index.html">Home</a></li>
        <li><a href="./about.html">About</a></li>
        <li><a href="./trackOrder.html">Track Order</a></li>
        <li><a href="./wishlist.html">Wishlist</a></li>
        <li><a href="./blog.html">Blog</a></li>
        <li><a href="./contact.html">Contact</a></li>
        <div class="flex gap-3 px-2">
                <li><a href="./products.html"><i class="cursor-pointer fa-solid fa-magnifying-glass"></i></a></li>
        <li class=""><i class=" fa-solid fa-user cursor-pointer text-[var(--dark)]"></i></li> 
      
        <li class="relative list-none">
                       <a class="text-[var(--orange)]" href="./cart.html"><i class="fa-solid fa-cart-shopping cursor-pointer text-[var(--dark)] text-xl"></i></a>
            <span id="cart-count" class="absolute -top-2 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full shadow">0</span></li>
       </div>
      </ul>
</div>
  <div id="userSectionContainer"></div>
<div class="my-12"></div>

<!-- main  -->
 <main  id="home" class="mb-44">
<div class="px-5 mx-5 my-10 flex justify-between">
<a onclick="goBack()"
   class="inline-flex items-center gap-2 bg-orange-400 hover:bg-orange-500 text-white font-medium px-5 py-2 rounded-2xl shadow-md transition duration-300">
  <i class="fas fa-arrow-left"></i> Back
</a>
<a href="./products.html" 
   class="inline-flex items-center gap-2 bg-orange-400 hover:bg-orange-500 text-white font-medium px-5 py-2 rounded-2xl shadow-md transition duration-300">
 products<i class="fa-solid fa-box"></i>

</a>
</div>

<section id="cartSection" class="flex flex-col gap-6 lg:flex-row md:items-start px-3 sm:px-5 md:px-10">
  <!-- products -->
  <div class="w-full overflow-x-auto">
    <table class="min-w-full text-center border-collapse shadow-md rounded-lg overflow-hidden text-sm sm:text-base">
      <thead class="bg-blue-500 text-white">
        <tr>
          <th class="px-2 sm:px-4 py-2 sm:py-3">#</th>
          <th class="px-2 sm:px-4 py-2 sm:py-3">Product</th>
          <th class="px-2 sm:px-4 py-2 sm:py-3">Price</th>
          <th class="px-2 sm:px-4 py-2 sm:py-3">Quantity</th>
          <th class="px-2 sm:px-4 py-2 sm:py-3">Subtotal</th>
          <th class="px-2 sm:px-4 py-2 sm:py-3">Delete</th>
        </tr>
      </thead>
      <tbody class="text-gray-800">

      </tbody>
    </table>
  </div>

  <!-- summary total -->
  <div class="w-full sm:w-[20rem] lg:w-[25rem] border border-gray-200 bg-white p-4 sm:p-6 rounded-lg shadow-lg flex flex-col gap-4 ">
    <h4 class="text-lg sm:text-xl font-semibold text-gray-800">Cart Totals</h4>

    <!-- subtotal -->
    <div class="flex justify-between items-center text-sm sm:text-base">
      <p class="text-gray-700">Subtotal</p>
      <p  class="text-green-500 font-semibold"><span id="subtotal">0</span> $</p>
    </div>
    <hr class="border-gray-300">

    <!-- coupon -->
    <div class="flex justify-between items-center text-sm sm:text-base text-gray-700">
      <p>Coupon</p>
      <p class="text-orange-500 font-semibold">0% off</p>
    </div>
    <hr class="border-gray-300">

    <!-- shipping -->
    <div class="flex justify-between items-center text-sm sm:text-base">
      <p class="text-gray-700">Shipping</p>
      <p class="text-green-500 font-medium">Flat rate: 1 $</p>
    </div>
    <a href="#" class="text-blue-500 text-xs sm:text-sm hover:underline">Change address</a>
    <hr class="border-gray-300">
<!-- input couponDiscount -->
    <div class="flex justify-between items-center text-base sm:text-lg font-semibold gap-2">
         <input id="couponDiscount" class="bg-slate-100 p-2 w-full rounded-md focus: outline-orange-200 focus:bg-orange-50 border-orange-400" placeholder="Add your coupon">
         <button id="couponDiscountBtn" class="bg-blue-950 px-5 text-white font-semibold py-2 rounded-lg shadow hover:bg-orange-600 transition text-sm sm:text-base">Apply</button>
    </div>
    <hr class="border-gray-300">

    <!-- total -->
    <div class="flex justify-between items-center text-base sm:text-lg font-semibold">
      <p >Total</p>
      <p class="text-green-600"><span  id="total">0</span> $</p>
    </div>
    <hr class="border-gray-300">

    <!-- buttons -->
    <div class="flex flex-col gap-3">
      <button onclick="confirmProcess(`Cash`)" id="confirm" class="bg-orange-500 text-white font-semibold py-2 rounded-lg shadow hover:bg-orange-600 transition text-sm sm:text-base">
        Proceed to Checkout
      </button>
      <p class="text-center text-gray-500 text-xs sm:text-sm">-- or --</p>
      <button onclick="confirmProcess(`payPal`)" id="confirm" class="border border-gray-300 py-2 bg-blue-950 text-white rounded-lg shadow hover:bg-blue-900 transition text-sm sm:text-base">
        Pay <span class="font-bold text-orange-500">Pal</span>
      </button>
    </div>
  </div>
</section>



<!-- Order Section -->
 <div>
<div id="orderSection" class="hidden fixed inset-0  overflow-auto  bg-black/40 flex items-center justify-center z-50 h-full">
  
  <div class="bg-white rounded-2xl shadow-lg w-[90%] sm:w-[600px] p-6 space-y-6 relative ">
    
    <!-- Close Button -->
    <button id="closeOrderSection" 
            class="absolute top-3 right-3 w-8 h-8 flex items-center justify-center 
                   rounded-full bg-gray-200 text-gray-600 hover:bg-gray-300 hover:text-black transition">
      <i class="fa-solid fa-xmark"></i>
    </button>

    <!-- Title -->
    <h2 class="text-2xl font-bold text-center text-gray-800">Confirm Your Order</h2>

    <!-- Form -->
    <form id="orderForm" class="space-y-4">

      <div>
        <label class="block text-gray-700 font-medium">Full Name</label>
        <input type="text" id="fullName" required
               class="w-full mt-1 p-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:outline-none">
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-gray-700 font-medium">Age</label>
          <input type="number" id="age" required min="10"
                 class="w-full mt-1 p-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:outline-none">
        </div>
        <div>
          <label class="block text-gray-700 font-medium">Phone Number</label>
          <input type="tel" id="phone" required pattern="[0-9]{11}"
                 class="w-full mt-1 p-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:outline-none">
        </div>
      </div>

      <div>
        <label class="block text-gray-700 font-medium">Governorate</label>
        <select id="governorate" required
                class="w-full mt-1 p-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:outline-none">
          <option value="">Select Governorate</option>
          <option value="Cairo">Cairo</option>
          <option value="Giza">Giza</option>
          <option value="Alexandria">Alexandria</option>
          <option value="Aswan">Aswan</option>
          <option value="Luxor">Luxor</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <div>
        <label class="block text-gray-700 font-medium">Region / Area</label>
        <input type="text" id="region" required
               class="w-full mt-1 p-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:outline-none">
      </div>

      <div>
        <label class="block text-gray-700 font-medium">Full Address</label>
        <textarea id="address" rows="3" required
                  class="w-full mt-1 p-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:outline-none"></textarea>
      </div>

      <div>
        <label class="block text-gray-700 font-medium">Additional Notes</label>
        <textarea id="notes" rows="2"
                  class="w-full mt-1 p-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:outline-none"></textarea>
      </div>

      <!-- Submit -->
      <button type="submit" 
              class="w-full py-3 rounded-xl bg-orange-500 text-white font-semibold text-lg hover:bg-orange-600 transition">
        Confirm Order
      </button>
    </form>
  </div>
</div>
</div>

 </main>

<div id="body"></div>

<!-- Modern Footer -->
<footer class="bg-gray-900 text-gray-400">
  <div class="border-t border-gray-700 mt-6 py-12 text-center">
<p class="text-2xl font-semibold text-white flex items-center justify-center gap-3">
  <i class="fas fa-laptop-code text-orange-400"></i>
  Eng. Kiroloes Reda
  <i class="fas fa-microchip text-orange-400"></i>
  <i class="fas fa-database text-orange-400"></i>
</p>
    <p class="text-lg mt-2">
      <span class="text-orange-400">&copy; 2025</span> FashionShopping. All rights reserved.
    </p>
  </div>
</footer>


  <script src="./main.js"></script>


<script>
  let totalPrice=0;
        let cartArraay=[]
        if(localStorage.getItem("token") && currentUser){
     cartArraay=currentUser.productCart ||[]
  }
  else{
    cartArraay= JSON.parse(localStorage.getItem("cartArray")) ;
  }
    const Tbody=document.getElementsByTagName("tbody")[0];
    function readTotal(){
    Tbody.innerHTML="";
    cartArraay.forEach((e,i,arr) => {
        
            Tbody.innerHTML+=`
            <tr class="bg-white even:bg-gray-50 hover:bg-gray-100 transition">
          <td class="px-2 sm:px-4 py-2 sm:py-3">${i+1}</td>
          <td class="px-2 sm:px-4 py-2 sm:py-3">
            <div class="flex flex-row items-center gap-2 sm:gap-3 justify-start">
              <img class="w-8 h-8 sm:w-10 sm:h-10 md:w-14 md:h-14 rounded-full shadow-sm" src=${e.image ||e.images[0]} alt="">
              <h3 class="font-medium text-xs sm:text-sm md:text-base">${e.title}</h3>
            </div>
          </td>
          <td class="px-2 sm:px-4 py-2 sm:py-3 font-semibold">${e.price} $</td>
          <td class="px-2 sm:px-4 py-2 sm:py-3">
            <div class="flex flex-row gap-2 sm:gap-4 items-center border rounded-lg px-2 sm:px-4 py-1 shadow-sm w-fit mx-auto">
              <!-- add -->
              <i onclick="add(${e.id})" class="fa-solid fa-plus cursor-pointer text-sm sm:text-lg text-gray-700 hover:text-orange-500 p-1 sm:p-2 rounded-full hover:bg-gray-100"></i>
              <!-- quantity -->
              <p id="displayQuentity" class="font-semibold text-sm sm:text-lg text-gray-800">${e.quantity}</p>
              <!-- reduce -->
              <i onclick="remove(${e.id})" class="fa-solid fa-minus cursor-pointer text-sm sm:text-lg text-gray-700 hover:text-orange-500 p-1 sm:p-2 rounded-full hover:bg-gray-100"></i>
            </div>
            
          </td>
          <td class="px-2 sm:px-4 py-2 sm:py-3 font-semibold text-green-600">${(e.quantity * e.price).toFixed(2)}$</td>
          <td class="px-2 sm:px-4 py-2 sm:py-3 font-semibold text-green-600">
             <i onclick="Delete(${e.id})" class="fa-solid fa-trash text-red-500 cursor-pointer hover:text-red-700 text-lg"></i>
        </td>
        </tr>


        `;
    });

    

    }
function summery() {

  let cartArraay2 = [];
  if (localStorage.getItem("token") && currentUser) {
    cartArraay2 = currentUser.productCart || [];
  } else {
    cartArraay2 = JSON.parse(localStorage.getItem("cartArray")) || [];
  }

   totalPrice = cartArraay2.reduce((total, currentPrice) => {
    return total + currentPrice.price * currentPrice.quantity;
  }, 0);
      document.getElementById("subtotal").innerHTML = (((totalPrice ) ).toFixed(2));


  
  document.getElementById("total").innerHTML = (totalPrice.toFixed(2));

  document.getElementById("couponDiscountBtn").addEventListener("click", () => {
    let coupons = JSON.parse(localStorage.getItem("discountCoupon")) || [];


    if (!Array.isArray(coupons)) {
      coupons = [coupons];
    }


    let access = coupons.filter(e =>
      e.couponDiscount === document.getElementById("couponDiscount").value && e.used === false
    );

    if (access.length !== 0) {
      totalPrice= (((totalPrice + 1) / 2).toFixed(2));
      document.getElementById("total").innerHTML =totalPrice;
       
      const index = coupons.findIndex(e => e.couponDiscount === access[0].couponDiscount);
      if (index !== -1) {
        coupons[index].used = true;
        if(currentUser){
        currentUser.coupon.used=true;
        localStorage.setItem("userArray",JSON.stringify(users))
        }
      
        localStorage.setItem("discountCoupon", JSON.stringify(coupons));
      }

      Swal.fire({
        icon: "success",
        title: "Congratulations!",
        html: `You get the discount Now!`,
        confirmButtonText: "OK"
      });

    } else {
      // كوبون غير موجود أو منتهي → التوتال يفضل زي ما هو (مافيش تحديث)
      Swal.fire({
        icon: "error",
        title: "Oops!",
        html: `Your coupon is expired or invalid.`,
        confirmButtonText: "OK"
      });
    }
  });
}

    

    function add(id){
        cartArraay.forEach((e,i,arr)=>{
           if(arr[i].id===id){
            arr[i].quantity+=1;
            console.log(arr[i]);
           }
        })
        localStorage.setItem("cartArray",JSON.stringify(cartArraay));
        readTotal();
        summery();
    }

        function Delete(id){
        cartArraay.forEach((e,i,arr)=>{
           if(arr[i].id===id){
             cartArraay.splice(i,1);
           }
        })
            if(localStorage.getItem("token") && currentUser){
 localStorage.setItem("userArray",JSON.stringify(users));
  }
  else{
    localStorage.setItem("cartArray",JSON.stringify(cartArraay));
  }
        
        
        readTotal();
        summery();
        cartcount()
        
        
    }
    
    function remove(id){
            
          cartArraay.forEach((e,i,arr)=>{
           if((arr[i].id===id)&&arr[i].quantity>1){
               arr[i].quantity-=1;
               console.log(arr[i]);
           }
           else if((arr[i].id===id)&&arr[i].quantity==1){
                   cartArraay.splice(i,1);
                   cartcount();
           }
           
          
           

        })
                   if(localStorage.getItem("token") && currentUser){
 localStorage.setItem("userArray",JSON.stringify(users));
  }
  else{
    localStorage.setItem("cartArray",JSON.stringify(cartArraay));
  }
        readTotal();
        summery();
        cartcount();
    }

      readTotal();
      summery();
// فتح وقفل الـ Order Section
document.getElementById("closeOrderSection").addEventListener("click", ()=>{
  document.getElementById("orderSection").classList.add("hidden");
});

// فتح الفورم
function openOrderForm(){
  document.getElementById("orderSection").classList.remove("hidden");
}


document.getElementById("orderForm").addEventListener("submit", function(e){
  e.preventDefault();


  order.username= document.getElementById("fullName").value;
  order.age=document.getElementById("age").value;
  order.phone= document.getElementById("phone").value;
  order.governorate= document.getElementById("governorate").value;
  order. region= document.getElementById("region").value;
     order.address=document.getElementById("address").value;
     order.orderNote=document.getElementById("notes").value;
     order.totalPrice=totalPrice

    
if (!currentUser.conifrmOrder) {
  currentUser.conifrmOrder = [];
}

if (currentUser.conifrmOrder.length === 0) {
  order.orderId = 1; 
} else {
  const lastOrder = currentUser.conifrmOrder[currentUser.conifrmOrder.length - 1].orderId;
  order.orderId = lastOrder + 1;
}


     

     order.totalPrice=totalPrice+1;
     order.products= (currentUser && currentUser.productCart) 
            ? currentUser.productCart 
            : (JSON.parse(localStorage.getItem("cartArray")) || [])


  const OrderArray= currentUser.conifrmOrder||[];
  OrderArray.push(order)
  

  localStorage.setItem("userArray", JSON.stringify(users));

  Swal.fire({
    icon: 'warning', 
    title: 'Confirm Order',
    text: 'Are you sure you want to confirm your order now?',
    confirmButtonText: 'Yes, Confirm',
    cancelButtonText: 'Cancel',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33'
  }).then(result => {
    if(result.isConfirmed){
        setTimeout(()=>{
           
            document.getElementById("orderSection").classList.add("hidden");
            
           
            if (currentUser) {
                currentUser.productCart = [];
                localStorage.setItem("userArray", JSON.stringify(users));
            } else {
                localStorage.removeItem("cartArray");
            }

          
            document.getElementById("orderForm").reset();

         

            Swal.fire("Done!", "Your order has been submitted successfully.", "success")
            .then(e=>{
              location.href="./index.html"
            });
        }, 500)
         
        
    }
  })
});

</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
</body>
</html>
